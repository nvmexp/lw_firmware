/* _LWRM_COPYRIGHT_BEGIN_
 *
 * Copyright 2021 by LWPU Corporation.  All rights reserved.    All
 * information contained herein is proprietary and confidential to LWPU
 * Corporation.  Any use, reproduction, or disclosure without the written
 * permission of LWPU Corporation is prohibited.
 *
 * _LWRM_COPYRIGHT_END_
 */

#include "lwriscv/manifest_t23x.h"

const PKC_VERIFICATION_MANIFEST manifest = {
    .version               = 0x1,
    .ucodeId               = 0x2,
    .ucodeVersion          = 0x1,
    .bRelaxedVersionCheck  = TRUE,
    .engineIdMask          = ENGINE_TO_ENGINE_ID_MASK(GSP),
    // This field will be patched during build
    .itcmSizeIn256Bytes    = 0,
    // This field will be patched during build
    .dtcmSizeIn256Bytes    = 0,
    .fmcHashPadInfoBitMask = 0x00000000,
    // NOT AUTOGENERATED! also must be !=0
    .CbcIv                 = { 0x27d0ef69, 0xc4bbca8a, 0x3437c8cb, 0x8cb8fc04 },
    // This field will be patched by siggen
    .digest                = { 0x00000000, 0x00000000, 0x00000000, 0x00000000,
                               0x00000000, 0x00000000, 0x00000000, 0x00000000 },
    .secretMask            = {
        .scpSecretMask     = 0x0000000000000000ULL,
        .scpSecretMaskLock = 0xFFFFFFFFFFFFFFFFULL,
    },
    .debugAccessControl    = {
        // Enable debugging for now, let Separation Kernel disable it if needed. It will be disabled in production.
        .dbgctl =
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_STOP,   _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_RUN,    _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_STEP,   _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_J,      _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_EMASK,  _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_RREG,   _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_WREG,   _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_RDM,    _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_WDM,    _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_RSTAT,  _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_IBRKPT, _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_RCSR,   _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_WCSR,   _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_RPC,    _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_RFREG,  _DISABLE ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _ICD_CMDWL_WFREG,  _DISABLE ) |

        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _START_IN_ICD,     _FALSE   ) |
        DRF_DEF(_PRGNLCL, _RISCV_DBGCTL, _SINGLE_STEP_MODE, _DISABLE ),

        .dbgctlLock = 0xFFFFFFFF,
    },
    .bDICE = FALSE,
    .bKDF  = FALSE,
    .mspm          = {
        .mplm  = LW_RISCV_CSR_MSPM_MPLM_LEVEL0,
        .msecm = 0x0
    },

    .kdfConstant = { 0 },
    // Locking everything in Device Map. It will be unlocked with justification.
    .deviceMap.deviceMap = {
        DEVICEMAP(_MMODE,          _ENABLE,  _ENABLE,  _UNLOCKED ) |
        DEVICEMAP(_RISCV_CTL,      _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_PIC,            _ENABLE,  _ENABLE,  _UNLOCKED ) |
        DEVICEMAP(_TIMER,          _ENABLE,  _ENABLE,  _UNLOCKED ) |
        DEVICEMAP(_HOSTIF,         _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_DMA,            _DISABLE, _DISABLE, _LOCKED   ) |
        // PMB must be unlocked so someone can write LOCKPMB (and then disable/lock it)
        DEVICEMAP(_PMB,            _ENABLE,  _ENABLE,  _UNLOCKED ) |
        DEVICEMAP(_DIO,            _DISABLE, _DISABLE, _LOCKED   ),

        DEVICEMAP(_KEY,            _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_DEBUG,          _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_SHA,            _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_KMEM,           _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_BROM,           _ENABLE,  _DISABLE, _LOCKED   ) | // BROM enforced
        DEVICEMAP(_ROM_PATCH,      _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_IOPMP,          _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_NOACCESS,       _DISABLE, _DISABLE, _LOCKED   ), // Empty Group

        DEVICEMAP(_SCP,            _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_FBIF,           _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_FALCON_ONLY,    _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_PRGN_CTL,       _ENABLE,  _ENABLE,  _UNLOCKED ) |
        DEVICEMAP(_SCRATCH_GROUP0, _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_SCRATCH_GROUP1, _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_SCRATCH_GROUP2, _DISABLE, _DISABLE, _LOCKED   ) |
        DEVICEMAP(_SCRATCH_GROUP3, _DISABLE, _DISABLE, _LOCKED   ),

        DEVICEMAP(_PLM,            _ENABLE,  _ENABLE,  _UNLOCKED ) |
        DEVICEMAP(_HUB_DIO,        _DISABLE, _DISABLE, _LOCKED   ),
    },

    .corePmp = {
        .pmpcfg = {
            // PMPCFG
            PMP_ENTRY(_PERMITTED, _DENIED,    _PERMITTED, _NAPOT, _LOCK), // IMEM, RX
            PMP_ENTRY(_PERMITTED, _PERMITTED, _DENIED,    _NAPOT, _LOCK), // DMEM, RW
            PMP_ENTRY(_PERMITTED, _PERMITTED, _DENIED,    _NAPOT, _LOCK), // LOCAL IO, RW
            PMP_ENTRY_OFF, // TOR start for PRIV
            PMP_ENTRY(_PERMITTED, _PERMITTED, _DENIED,    _TOR,   _LOCK), // TOR - PRIV RW
            PMP_ENTRY_OFF, // TOR start for SYSGPA
            PMP_ENTRY(_PERMITTED, _PERMITTED, _DENIED,    _TOR,   _LOCK), // TOR - SYSGPA RW
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
            PMP_ENTRY_OFF,
        },
        .pmpaddr = {
            0x000000000004FFFF, // IMEM
            0x000000000006FFFF, // DMEM
            ((LW_RISCV_AMAP_INTIO_START >> 2) | ((LW_RISCV_AMAP_INTIO_SIZE - 1) >> 3)),
            (LW_RISCV_AMAP_PRIV_START >> 2),
            (LW_RISCV_AMAP_PRIV_END   >> 2),
            (LW_RISCV_AMAP_SYSGPA_START >> 2),
            (LW_RISCV_AMAP_SYSGPA_END >> 2),
        },
    },

    // IO_PMP_MODE - NAPOT for all entries as that's the only mode we support
    .ioPmpMode = 0x3f,

    .ioPmp = {
        .iopmpcfg = {
            // DMEM print buffer - part 1
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _READ,   _ENABLE)              |
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _WRITE,  _DISABLE)             |
            DRF_IDX_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _MASTER_PMB, 0 , _ENABLE)  |
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _LOCK,   _LOCKED),

            // DMEM print buffer - part 2
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _READ,   _ENABLE)              |
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _WRITE,  _DISABLE)             |
            DRF_IDX_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _MASTER_PMB, 0 , _ENABLE)  |
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _LOCK,   _LOCKED),

            // Whole address space
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _READ,   _DISABLE)             |
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _WRITE,  _DISABLE)             |
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _MASTER, _ALL_MASTERS_ENABLED) |
            DRF_DEF(_PRGNLCL, _RISCV_IOPMP_CFG, _LOCK,   _LOCKED),
        },
        .iopmpaddrlo = {
            0x63eff, // Range: 000000000018f800-000000000018ffff size:800 (2048 bytes)
            0x63d7f, // Range: 000000000018f400-000000000018f7ff size:400 (1024 bytes)
            0xFFFFFFFF,
        },
        .iopmpaddrhi = { // Must be always 0 for IMEM and DMEM
            0,
            0,
            0xbFFFFFFF,
        },
    },

    .numberOfValidPairs = 0x0,
    .registerPair        = {
        .addr     = { },
        .andMask = { },
        .orMask  = { },
    },
};
